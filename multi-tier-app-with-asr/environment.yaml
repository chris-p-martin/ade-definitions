name: MultiTierVMwithASR
version: 1.0.0
summary: Multi-tier app with optional multi-region ASR failover
description: Deploy a highly available multi-tier application architecture with Web Apps and SQL Database, with optional Azure Site Recovery for disaster recovery.
runner: "acrdemodevcenter28d1i.azurecr.io/terraform-runner:latest"
templatePath: main.tf

parameters:
  - id: environment_name
    name: Environment Name
    description: Name for this environment (1-20 chars, lowercase alphanumeric and hyphens)
    type: string
    required: true

  - id: primary_location
    name: Primary Region
    description: Primary Azure region for active resources
    type: string
    required: false
    default: eastus
    allowed:
      - eastus
      - eastus2
      - westus
      - westus2
      - westus3
      - centralus
      - northeurope
      - westeurope
      - southeastasia
      - eastasia
      - japaneast

  - id: secondary_location
    name: Secondary Region
    description: Secondary region for ASR failover (must be different from primary)
    type: string
    required: false
    default: westus
    allowed:
      - eastus
      - eastus2
      - westus
      - westus2
      - westus3
      - centralus
      - northeurope
      - westeurope
      - southeastasia
      - eastasia
      - japaneast

  - id: enable_asr
    name: Enable ASR
    description: Enable Azure Site Recovery for multi-region failover capability
    type: boolean
    required: false
    default: true

  - id: num_tiers
    name: Number of Tiers
    description: Number of application tiers (2 for web+app, 3 for web+app+data)
    type: integer
    required: false
    default: 3
    allowed:
      - 2
      - 3

  - id: num_instances_per_tier
    name: Instances per Tier
    description: Number of App Service instances per tier for load balancing (1-5)
    type: integer
    required: false
    default: 2
    allowed:
      - 1
      - 2
      - 3
      - 4
      - 5

  - id: tier_sku_configs
    name: Tier SKU Configuration
    description: SQL and App Service tier configuration (Standard or Premium)
    type: object
    required: false
    default:
      tier1:
        tier: Standard
        size: S1
      tier2:
        tier: Standard
        size: S1
      tier3:
        tier: Standard
        size: S1

  - id: enable_app_insights
    name: Enable Application Insights
    description: Enable Azure Application Insights for performance monitoring
    type: boolean
    required: false
    default: true

  - id: db_admin_username
    name: Database Admin Username
    description: SQL Database administrator login name (avoid reserved names like admin or sa)
    type: string
    required: false
    default: azadmin

  - id: db_admin_password
    name: Database Admin Password
    description: SQL Database administrator password (8+ chars with uppercase, lowercase, number)
    type: string
    required: true